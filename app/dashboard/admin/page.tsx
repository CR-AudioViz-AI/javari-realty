"import { createClient } from '@/lib/supabase/server'\nimport { redirect } from 'next/navigation'\nimport Link from 'next/link'\nimport {\n  Shield,\n  Users,\n  Building2,\n  TrendingUp,\n  Settings,\n  ChevronRight,\n} from 'lucide-react'\nimport { Database } from '@/types/database.complete'\n\nexport default async function AdminDashboard() {\n  const supabase = createClient()\n\n  // Get current user\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    redirect('/auth/login')\n  }\n\n  // Verify admin role\n  const { data: profile, error: profileError } = await supabase\n    .from('profiles')\n    .select('role')\n    .eq('id', user.id)\n    .single()\n\n  // Combined check: if error OR no profile data, redirect\n  if (profileError || !profile) {\n    redirect('/dashboard')\n  }\n\n  // TypeScript now knows profile is non-null and has role property\n  if (profile.role !== 'platform_admin') {\n    redirect('/dashboard')\n  }\n\n  // Get platform metrics\n  const { data: allProfiles } = await supabase\n    .from('profiles')\n    .select('id, role')\n    \n  // FIX #1: Changed 'organizations' to 'brokers' (correct table name)\n  const { data: brokers } = await supabase\n    .from('brokers')\n    .select('id')\n  \n  const { data: properties } = await supabase\n    .from('properties')\n    .select('id')\n  \n  // FIX #2: Changed .select('id, status') to .select('id, stage')\n  const { data: transactions } = await supabase\n    .from('transactions')\n    .select('id, stage')\n\n  const metrics = [\n    {\n      name: 'Total Users',\n      value: allProfiles?.length || 0,\n      breakdown: `${allProfiles?.filter((p) => p.role === 'realtor').length || 0} Realtors`,\n      icon: Users,\n      color: 'blue',\n    },\n    {\n      name: 'Brokers',\n      value: brokers?.length || 0,\n      // FIX #3: Changed role === 'broker' to role === 'broker_admin'\n      breakdown: `${allProfiles?.filter((p) => p.role === 'broker_admin').length || 0} Admins`,\n      icon: Building2,\n      color: 'purple',\n    },\n    {\n      name: 'Active Transactions',\n      // FIX #2: Changed 'status' to 'stage' and used valid stage values\n      value: transactions?.filter((t) => \n        t.stage === 'under_contract' || \n        t.stage === 'inspection' || \n        t.stage === 'appraisal' || \n        t.stage === 'financing'\n      ).length || 0,\n      breakdown: `${transactions?.filter((t) => t.stage === 'completed').length || 0} Completed`,\n      icon: TrendingUp,\n      color: 'green',\n    },\n    {\n      name: 'Total Properties',\n      value: properties?.length || 0,\n      breakdown: `Platform-wide listings`,\n      icon: Settings,\n      color: 'orange',\n    },\n  ]\n\n  const quickLinks = [\n    {\n      name: 'User Management',\n      description: 'View and manage all platform users',\n      href: '/dashboard/admin/users',\n      icon: Users,\n    },\n    {\n      name: 'Brokers',\n      description: 'Manage brokers and offices',\n      href: '/dashboard/admin/brokers',\n      icon: Building2,\n    },\n    {\n      name: 'Properties',\n      description: 'View all platform properties',\n      href: '/dashboard/admin/properties',\n      icon: Building2,\n    },\n    {\n      name: 'Analytics',\n      description: 'View platform-wide analytics',\n      href: '/dashboard/admin/analytics',\n      icon: TrendingUp,\n    },\n  ]\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Admin header */}\n      <div className=\"bg-gradient-to-r from-red-600 to-orange-600 rounded-lg p-6 text-white\">\n        <div className=\"flex items-center mb-2\">\n          <Shield className=\"w-8 h-8 mr-3\" />\n          <h2 className=\"text-2xl font-bold\">Platform Admin</h2>\n        </div>\n        <p className=\"text-red-100\">\n          Complete control over the CR Realtor Platform\n        </p>\n      </div>\n\n      {/* Metrics grid */}\n      <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4\">\n        {metrics.map((metric) => (\n          <div\n            key={metric.name}\n            className=\"bg-white rounded-lg border border-gray-200 p-6 hover:shadow-lg transition-shadow\"\n          >\n            <div className=\"flex items-center justify-between mb-4\">\n              <div\n                className={`p-2 bg-${metric.color}-50 rounded-lg`}\n              >\n                <metric.icon className={`w-6 h-6 text-${metric.color}-600`} />\n              </div>\n            </div>\n            <p className=\"text-sm text-gray-600 mb-1\">{metric.name}</p>\n            <p className=\"text-3xl font-bold text-gray-900 mb-1\">\n              {metric.value}\n            </p>\n            <p className=\"text-xs text-gray-500\">{metric.breakdown}</p>\n          </div>\n        ))}\n      </div>\n\n      {/* Quick links */}\n      <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n          Quick Actions\n        </h3>\n        <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2\">\n          {quickLinks.map((link) => (\n            <Link\n              key={link.name}\n              href={link.href}\n              className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition-all group\"\n            >\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"p-2 bg-gray-50 rounded-lg group-hover:bg-blue-50 transition-colors\">\n                  <link.icon className=\"w-5 h-5 text-gray-600 group-hover:text-blue-600\" />\n                </div>\n                <div>\n                  <p className=\"font-medium text-gray-900 group-hover:text-blue-600\">\n                    {link.name}\n                  </p>\n                  <p className=\"text-sm text-gray-600\">{link.description}</p>\n                </div>\n              </div>\n              <ChevronRight className=\"w-5 h-5 text-gray-400 group-hover:text-blue-600\" />\n            </Link>\n          ))}\n        </div>\n      </div>\n\n      {/* Recent activity */}\n      <div className=\"bg-white rounded-lg border border-gray-200 p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n          Recent Platform Activity\n        </h3>\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n            <div>\n              <p className=\"font-medium text-gray-900\">New Broker Registered</p>\n              <p className=\"text-sm text-gray-600\">Real Estate Group</p>\n            </div>\n            <p className=\"text-sm text-gray-500\">2 hours ago</p>\n          </div>\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n            <div>\n              <p className=\"font-medium text-gray-900\">New Property Listed</p>\n              <p className=\"text-sm text-gray-600\">123 Main Street</p>\n            </div>\n            <p className=\"text-sm text-gray-500\">5 hours ago</p>\n          </div>\n          <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n            <div>\n              <p className=\"font-medium text-gray-900\">New Realtor Signup</p>\n              <p className=\"text-sm text-gray-600\">5 new realtors today</p>\n            </div>\n            <p className=\"text-sm text-gray-500\">Today</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"